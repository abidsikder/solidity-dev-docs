<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>SqrtPriceMath - Solidity DevDocs</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "SqrtPriceMath";
        var mkdocs_page_input_path = "uniswap-v3-core/libraries/SqrtPriceMath.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Solidity DevDocs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Prb math</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../prb-math/PRBMath/">PRBMath</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../prb-math/PRBMathSD59x18/">PRBMathSD59x18</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../prb-math/PRBMathSD59x18Typed/">PRBMathSD59x18Typed</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../prb-math/PRBMathUD60x18/">PRBMathUD60x18</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../prb-math/PRBMathUD60x18Typed/">PRBMathUD60x18Typed</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Solidity trigonometry</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../solidity-trigonometry/Trigonometry/">Trigonometry</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Spatial sol</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../spatial-sol/Jurisdiction/">Jurisdiction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../spatial-sol/LocationAware/">LocationAware</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../spatial-sol/Migrations/">Migrations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../spatial-sol/Spatial/">Spatial</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../spatial-sol/Trigonometry/">Trigonometry</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Uniswap v3 core</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../NoDelegateCall/">NoDelegateCall</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../UniswapV3Factory/">UniswapV3Factory</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../UniswapV3Pool/">UniswapV3Pool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../UniswapV3PoolDeployer/">UniswapV3PoolDeployer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Interfaces</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/IERC20Minimal/">IERC20Minimal</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/IUniswapV3Factory/">IUniswapV3Factory</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/IUniswapV3Pool/">IUniswapV3Pool</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../interfaces/IUniswapV3PoolDeployer/">IUniswapV3PoolDeployer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Callback</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../interfaces/callback/IUniswapV3FlashCallback/">IUniswapV3FlashCallback</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../interfaces/callback/IUniswapV3MintCallback/">IUniswapV3MintCallback</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../interfaces/callback/IUniswapV3SwapCallback/">IUniswapV3SwapCallback</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Pool</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../interfaces/pool/IUniswapV3PoolActions/">IUniswapV3PoolActions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../interfaces/pool/IUniswapV3PoolDerivedState/">IUniswapV3PoolDerivedState</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../interfaces/pool/IUniswapV3PoolEvents/">IUniswapV3PoolEvents</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../interfaces/pool/IUniswapV3PoolImmutables/">IUniswapV3PoolImmutables</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../interfaces/pool/IUniswapV3PoolOwnerActions/">IUniswapV3PoolOwnerActions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../interfaces/pool/IUniswapV3PoolState/">IUniswapV3PoolState</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Libraries</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../BitMath/">BitMath</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../FixedPoint128/">FixedPoint128</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../FixedPoint96/">FixedPoint96</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../FullMath/">FullMath</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../LiquidityMath/">LiquidityMath</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../LowGasSafeMath/">LowGasSafeMath</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Oracle/">Oracle</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Position/">Position</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../SafeCast/">SafeCast</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">SqrtPriceMath</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#getnextsqrtpricefromamount0roundingup">getNextSqrtPriceFromAmount0RoundingUp</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getnextsqrtpricefromamount1roundingdown">getNextSqrtPriceFromAmount1RoundingDown</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getnextsqrtpricefrominput">getNextSqrtPriceFromInput</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getnextsqrtpricefromoutput">getNextSqrtPriceFromOutput</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getamount0delta">getAmount0Delta</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getamount1delta">getAmount1Delta</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getamount0delta_1">getAmount0Delta</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getamount1delta_1">getAmount1Delta</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../SwapMath/">SwapMath</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Tick/">Tick</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../TickBitmap/">TickBitmap</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../TickMath/">TickMath</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../TransferHelper/">TransferHelper</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../UnsafeMath/">UnsafeMath</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Solidity DevDocs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Uniswap v3 core &raquo;</li>
          <li>Libraries &raquo;</li>
      <li>SqrtPriceMath</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="sqrtpricemath">SqrtPriceMath</h2>
<p>Contains the math that uses square root of price as a Q64.96 and liquidity to compute deltas</p>
<h3 id="getnextsqrtpricefromamount0roundingup">getNextSqrtPriceFromAmount0RoundingUp</h3>
<pre><code class="language-solidity">function getNextSqrtPriceFromAmount0RoundingUp(uint160 sqrtPX96, uint128 liquidity, uint256 amount, bool add) internal pure returns (uint160)
</code></pre>
<p>Gets the next sqrt price given a delta of token0</p>
<p><em>Always rounds up, because in the exact output case (increasing price) we need to move the price at least
far enough to get the desired output amount, and in the exact input case (decreasing price) we need to move the
price less in order to not send too much output.
The most precise formula for this is liquidity * sqrtPX96 / (liquidity +- amount * sqrtPX96),
if this is impossible because of overflow, we calculate liquidity / (liquidity / sqrtPX96 +- amount).</em></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqrtPX96</td>
<td>uint160</td>
<td>The starting price, i.e. before accounting for the token0 delta</td>
</tr>
<tr>
<td>liquidity</td>
<td>uint128</td>
<td>The amount of usable liquidity</td>
</tr>
<tr>
<td>amount</td>
<td>uint256</td>
<td>How much of token0 to add or remove from virtual reserves</td>
</tr>
<tr>
<td>add</td>
<td>bool</td>
<td>Whether to add or remove the amount of token0</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[0]</td>
<td>uint160</td>
<td>The price after adding or removing amount, depending on add</td>
</tr>
</tbody>
</table>
<h3 id="getnextsqrtpricefromamount1roundingdown">getNextSqrtPriceFromAmount1RoundingDown</h3>
<pre><code class="language-solidity">function getNextSqrtPriceFromAmount1RoundingDown(uint160 sqrtPX96, uint128 liquidity, uint256 amount, bool add) internal pure returns (uint160)
</code></pre>
<p>Gets the next sqrt price given a delta of token1</p>
<p><em>Always rounds down, because in the exact output case (decreasing price) we need to move the price at least
far enough to get the desired output amount, and in the exact input case (increasing price) we need to move the
price less in order to not send too much output.
The formula we compute is within &lt;1 wei of the lossless version: sqrtPX96 +- amount / liquidity</em></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqrtPX96</td>
<td>uint160</td>
<td>The starting price, i.e., before accounting for the token1 delta</td>
</tr>
<tr>
<td>liquidity</td>
<td>uint128</td>
<td>The amount of usable liquidity</td>
</tr>
<tr>
<td>amount</td>
<td>uint256</td>
<td>How much of token1 to add, or remove, from virtual reserves</td>
</tr>
<tr>
<td>add</td>
<td>bool</td>
<td>Whether to add, or remove, the amount of token1</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[0]</td>
<td>uint160</td>
<td>The price after adding or removing <code>amount</code></td>
</tr>
</tbody>
</table>
<h3 id="getnextsqrtpricefrominput">getNextSqrtPriceFromInput</h3>
<pre><code class="language-solidity">function getNextSqrtPriceFromInput(uint160 sqrtPX96, uint128 liquidity, uint256 amountIn, bool zeroForOne) internal pure returns (uint160 sqrtQX96)
</code></pre>
<p>Gets the next sqrt price given an input amount of token0 or token1</p>
<p><em>Throws if price or liquidity are 0, or if the next price is out of bounds</em></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqrtPX96</td>
<td>uint160</td>
<td>The starting price, i.e., before accounting for the input amount</td>
</tr>
<tr>
<td>liquidity</td>
<td>uint128</td>
<td>The amount of usable liquidity</td>
</tr>
<tr>
<td>amountIn</td>
<td>uint256</td>
<td>How much of token0, or token1, is being swapped in</td>
</tr>
<tr>
<td>zeroForOne</td>
<td>bool</td>
<td>Whether the amount in is token0 or token1</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqrtQX96</td>
<td>uint160</td>
<td>The price after adding the input amount to token0 or token1</td>
</tr>
</tbody>
</table>
<h3 id="getnextsqrtpricefromoutput">getNextSqrtPriceFromOutput</h3>
<pre><code class="language-solidity">function getNextSqrtPriceFromOutput(uint160 sqrtPX96, uint128 liquidity, uint256 amountOut, bool zeroForOne) internal pure returns (uint160 sqrtQX96)
</code></pre>
<p>Gets the next sqrt price given an output amount of token0 or token1</p>
<p><em>Throws if price or liquidity are 0 or the next price is out of bounds</em></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqrtPX96</td>
<td>uint160</td>
<td>The starting price before accounting for the output amount</td>
</tr>
<tr>
<td>liquidity</td>
<td>uint128</td>
<td>The amount of usable liquidity</td>
</tr>
<tr>
<td>amountOut</td>
<td>uint256</td>
<td>How much of token0, or token1, is being swapped out</td>
</tr>
<tr>
<td>zeroForOne</td>
<td>bool</td>
<td>Whether the amount out is token0 or token1</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqrtQX96</td>
<td>uint160</td>
<td>The price after removing the output amount of token0 or token1</td>
</tr>
</tbody>
</table>
<h3 id="getamount0delta">getAmount0Delta</h3>
<pre><code class="language-solidity">function getAmount0Delta(uint160 sqrtRatioAX96, uint160 sqrtRatioBX96, uint128 liquidity, bool roundUp) internal pure returns (uint256 amount0)
</code></pre>
<p>Gets the amount0 delta between two prices</p>
<p><em>Calculates liquidity / sqrt(lower) - liquidity / sqrt(upper),
i.e. liquidity * (sqrt(upper) - sqrt(lower)) / (sqrt(upper) * sqrt(lower))</em></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqrtRatioAX96</td>
<td>uint160</td>
<td>A sqrt price</td>
</tr>
<tr>
<td>sqrtRatioBX96</td>
<td>uint160</td>
<td>Another sqrt price</td>
</tr>
<tr>
<td>liquidity</td>
<td>uint128</td>
<td>The amount of usable liquidity</td>
</tr>
<tr>
<td>roundUp</td>
<td>bool</td>
<td>Whether to round the amount up or down</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>amount0</td>
<td>uint256</td>
<td>Amount of token0 required to cover a position of size liquidity between the two passed prices</td>
</tr>
</tbody>
</table>
<h3 id="getamount1delta">getAmount1Delta</h3>
<pre><code class="language-solidity">function getAmount1Delta(uint160 sqrtRatioAX96, uint160 sqrtRatioBX96, uint128 liquidity, bool roundUp) internal pure returns (uint256 amount1)
</code></pre>
<p>Gets the amount1 delta between two prices</p>
<p><em>Calculates liquidity * (sqrt(upper) - sqrt(lower))</em></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqrtRatioAX96</td>
<td>uint160</td>
<td>A sqrt price</td>
</tr>
<tr>
<td>sqrtRatioBX96</td>
<td>uint160</td>
<td>Another sqrt price</td>
</tr>
<tr>
<td>liquidity</td>
<td>uint128</td>
<td>The amount of usable liquidity</td>
</tr>
<tr>
<td>roundUp</td>
<td>bool</td>
<td>Whether to round the amount up, or down</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>amount1</td>
<td>uint256</td>
<td>Amount of token1 required to cover a position of size liquidity between the two passed prices</td>
</tr>
</tbody>
</table>
<h3 id="getamount0delta_1">getAmount0Delta</h3>
<pre><code class="language-solidity">function getAmount0Delta(uint160 sqrtRatioAX96, uint160 sqrtRatioBX96, int128 liquidity) internal pure returns (int256 amount0)
</code></pre>
<p>Helper that gets signed token0 delta</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqrtRatioAX96</td>
<td>uint160</td>
<td>A sqrt price</td>
</tr>
<tr>
<td>sqrtRatioBX96</td>
<td>uint160</td>
<td>Another sqrt price</td>
</tr>
<tr>
<td>liquidity</td>
<td>int128</td>
<td>The change in liquidity for which to compute the amount0 delta</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>amount0</td>
<td>int256</td>
<td>Amount of token0 corresponding to the passed liquidityDelta between the two prices</td>
</tr>
</tbody>
</table>
<h3 id="getamount1delta_1">getAmount1Delta</h3>
<pre><code class="language-solidity">function getAmount1Delta(uint160 sqrtRatioAX96, uint160 sqrtRatioBX96, int128 liquidity) internal pure returns (int256 amount1)
</code></pre>
<p>Helper that gets signed token1 delta</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqrtRatioAX96</td>
<td>uint160</td>
<td>A sqrt price</td>
</tr>
<tr>
<td>sqrtRatioBX96</td>
<td>uint160</td>
<td>Another sqrt price</td>
</tr>
<tr>
<td>liquidity</td>
<td>int128</td>
<td>The change in liquidity for which to compute the amount1 delta</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>amount1</td>
<td>int256</td>
<td>Amount of token1 corresponding to the passed liquidityDelta between the two prices</td>
</tr>
</tbody>
</table>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../SafeCast/" class="btn btn-neutral float-left" title="SafeCast"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../SwapMath/" class="btn btn-neutral float-right" title="SwapMath">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../SafeCast/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../SwapMath/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
